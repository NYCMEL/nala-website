<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NALA API Test Console</title>

<style>
body{font-family:system-ui,Arial;padding:16px;line-height:1.3;background:#fafafa}
.card{border:1px solid #ddd;border-radius:10px;padding:12px;margin:12px 0;background:#fff}
.row{display:flex;gap:12px;flex-wrap:wrap}
label{display:block;font-weight:600;margin-top:8px}
input{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px}
button{padding:10px 12px;border:0;border-radius:10px;cursor:pointer}
.primary{background:#0b5;color:#fff}
.secondary{background:#eee}
.danger{background:#c33;color:#fff}
pre{background:#0b0b0b;color:#e6e6e6;padding:12px;border-radius:10px;overflow:auto}
.small{font-size:12px;color:#555}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>

<body>

<h1>NALA API Test Console</h1>

<div class="card">
<label>API Base URL</label>
<input id="apiBase" class="mono" value="https://nala-test.com/api">
<div class="small">Your APIs live in public_html/api</div>
</div>

<!-- LOGIN -->
<div class="card">
<h2>Login</h2>
<div class="row">
<div style="flex:1">
<label>Email</label>
<input id="email">
</div>
<div style="flex:1">
<label>Password</label>
<input id="password" type="password">
</div>
</div>

<div class="row" style="margin-top:10px">
<button class="primary" onclick="login()">Login</button>
<button class="secondary" onclick="getCurriculum()">Fetch Curriculum</button>
<button class="secondary" onclick="lessonComplete()">Lesson Complete</button>
</div>
</div>

<!-- QUIZ -->
<div class="card">
<h2>Record Quiz</h2>
<div class="row">
<div style="flex:1">
<label>quiz_key</label>
<input id="quiz_key" value="p0_m0">
</div>
<div style="flex:1">
<label>percent</label>
<input id="percent" type="number" value="85">
</div>
<div style="flex:1">
<label>score</label>
<input id="score" type="number" value="17">
</div>
<div style="flex:1">
<label>total</label>
<input id="total" type="number" value="20">
</div>
</div>

<div class="row" style="margin-top:10px">
<button class="primary" onclick="recordQuiz()">Submit Quiz</button>
</div>
</div>

<!-- INPUT -->
<div class="card">
<h2>Input / Request</h2>
<pre id="req">{}</pre>
</div>

<!-- OUTPUT -->
<div class="card">
<h2>Output</h2>
<pre id="out">{}</pre>
</div>

<script>

function apiBase(){
  return document.getElementById('apiBase').value.replace(/\/+$/,'');
}

function showRequest(info){
  document.getElementById('req').textContent =
    JSON.stringify(info,null,2);
}

function showOutput(info){
  document.getElementById('out').textContent =
    JSON.stringify(info,null,2);
}

async function request(path,opts={}){
  const url = apiBase()+path;

  const finalOpts={
    ...opts,
    credentials:'include'
  };

  finalOpts.headers=finalOpts.headers||{};
  if(finalOpts.method && finalOpts.method!=='GET'){
    finalOpts.headers['Content-Type']='application/json';
  }

  showRequest({
    url,
    method:finalOpts.method||'GET',
    headers:finalOpts.headers,
    body:finalOpts.body?JSON.parse(finalOpts.body):null
  });

  try{
    const res=await fetch(url,finalOpts);
    const text=await res.text();
    let data;
    try{data=JSON.parse(text);}catch{data={raw:text};}

    showOutput({
      status:res.status,
      ok:res.ok,
      response:data
    });

    return data;
  }
  catch(e){
    showOutput({error:String(e)});
  }
}

/* -------- API FUNCTIONS -------- */

function login(){
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;

  request('/login_api.php',{
    method:'POST',
    body:JSON.stringify({email,password})
  });
}

function getCurriculum(){
  request('/curriculum_api.php',{method:'GET'});
}

function lessonComplete(){
  request('/lesson_complete.php',{method:'POST'});
}

function recordQuiz(){
  const quiz_key=document.getElementById('quiz_key').value;
  const percent=parseInt(document.getElementById('percent').value,10);
  const score=parseInt(document.getElementById('score').value,10);
  const total=parseInt(document.getElementById('total').value,10);

  request('/quiz_record_score.php',{
    method:'POST',
    body:JSON.stringify({quiz_key,percent,score,total})
  });
}

</script>

</body>
</html>