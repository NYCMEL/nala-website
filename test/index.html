<!DOCTYPE html>
<html lang="en">
    <head>
	<meta charset="UTF-8">
	<title>API TESTING</title>

	<base href="/repo_deploy/">

	<!-- W3C LOGGING -->
	<script>
	 wcENV="dev"; // prod || dev
	 wcAPP="NALA";
	 wcTOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9." +
		   "eyJ1c2VySWQiOiJ0ZXN0LXVzZXIiLCJyb2xlIjoiZGV2IiwiZXhwIjo5OTk5OTk5OTk5fQ." +
		   "dGhpcy1pcy1hLWZha2UtdG9rZW4tZm9yLXRlc3Rpbmc";
	</script>
    </head>

    <body id="wc">
	<script src="js/_wc.js"></script>
	<script src="js/api.js"></script>

	<div id="api_base" value=""</div>

	<pre id="req_out"></pre>
	<pre id="res_out"></pre>

	<span id="last_method"></span>
	<span id="last_url"></span>
	<span id="last_status"></span>
	<pre id="session_out"></pre>

	<h1>OPEN THE CONSOLE</h1>

	<!-- FOR API TESTING -->
	<script>
	 let url = "https://nala-test.com";
	 
	 // data FOR LOGIN TESTING
	 let email = "mel@google.com";
	 let password = "testing";

	 function doLogout() {
	     // LOGOUT
	     (() => {
		 (async () => {
		     await fetch(url + "/api/auth_logout.php", {
			 method: "POST",
			 credentials: "include"
		     });
		     let currentUser = null;
		     wc.log("logged out");
		 })().catch(console.error);
	     })();
	 }

	 function doLogin(email,passwd) {
	     // LOGIN
	     (() => {
		 (async () => {
		     const res = await fetch(url + "/api/login_api.php", {
			 method: "POST",
			 credentials: "include",
			 headers: { "Content-Type": "application/json" },
			 body: JSON.stringify({
			     email: email,
			     password: passwd
			 })
		     });

		     window.x = res;

		     console.log(">>>>>>>", res.ok);

		     const data = await res.json();

		     if (!res.ok) throw new Error(data.error || "Login failed");

		     const currentUser = data.user;
		     console.log("login ok", currentUser);
		 })().catch(console.error);
	     })
	 }
	 
	 switch(2) 
	 {
	     case 1:
	     doLogout();
	     break;
	     
	     case 2:
	     doLogin("mel@google.com", "test");
	     break;
	 }
	 
	</script>

    </body>
</html>
