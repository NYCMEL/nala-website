<!DOCTYPE html>
<html lang="en">
    <head>
	<meta charset="UTF-8">
	<title>API TESTING</title>

	<base href="/repo_deploy/">

	<!-- W3C LOGGING -->
	<script>
	 wcENV="dev"; // prod || dev
	 wcAPP="NALA";
	 wcTOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9." +
		   "eyJ1c2VySWQiOiJ0ZXN0LXVzZXIiLCJyb2xlIjoiZGV2IiwiZXhwIjo5OTk5OTk5OTk5fQ." +
		   "dGhpcy1pcy1hLWZha2UtdG9rZW4tZm9yLXRlc3Rpbmc";
	</script>
    </head>

    <body id="wc">
	<script src="js/_wc.js"></script>
	<script src="js/api.js"></script>

	<div id="api_base" value=""</div>

	<pre id="req_out"></pre>
	<pre id="res_out"></pre>

	<span id="last_method"></span>
	<span id="last_url"></span>
	<span id="last_status"></span>
	<pre id="session_out"></pre>

	<h1>OPEN THE CONSOLE</h1>

	<!-- FOR API TESTING -->
	<script>
	 let url = "https://nala-test.com";
	 
	 // data FOR LOGIN TESTING
	 let email = "mel@google.com";
	 let password = "testing";

	 document.body.innerHTML += "<p>" + url + "</p>";

	 switch(2) 
	 {
	     case 1:
	     /** LOGOUT: clears session cookie server-side */
	     const res = await fetch("https://nala-test.com/api/auth_logout.php", {
		 method: "POST",
		 credentials: "include" // REQUIRED
	     });

	     const data = await res.json().catch(() => ({}));

	     if (!res.ok) throw new Error(data.error || "Logout failed");
	     
	     // clear FE state:
	     let currentUser = null;
	     break;
	     
	     case 2:
	     /** LOGIN: sets HttpOnly cookie (nala_session) */
	     const res = await fetch("https://nala-test.com/api/login_api.php", {
		 method: "POST",
		 credentials: "include", // REQUIRED
		 headers: { "Content-Type": "application/json" },
		 body: JSON.stringify({
		     email: "mel@google.com",
		     password: "test"
		 })
	     });

	     const data = await res.json();

	     if (!res.ok) throw new Error(data.error || "Login failed");

	     // user object:
	     const currentUser = data.user;

	     // verify session (optional):
	     const meRes = await fetch("https://nala-test.com/api/me.php", { credentials: "include" });

	     const me = await meRes.json();
	     wc.loc(">>>>>>>", me);
	     break;
	 }
	</script>
    </body>
</html>
