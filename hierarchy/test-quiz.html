<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MTK Hierarchy - Quiz Test</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Roboto Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- Hierarchy Styles -->
  <link rel="stylesheet" href="mtk-hierarchy.css">
  
  <style>
    body {
      margin: 0;
      padding: 20px 0;
      background-color: #f5f5f5;
      font-family: 'Roboto', sans-serif;
    }
    .debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: white;
      padding: 15px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      max-width: 300px;
      z-index: 9999;
    }
    .debug-panel h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      font-weight: 500;
    }
    .debug-panel button {
      margin: 5px 0;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Debug Panel -->
  <div class="debug-panel">
    <h3>üîß Debug Controls</h3>
    <button class="btn btn-sm btn-primary" onclick="unlockQuiz()">Unlock Quiz (Module 1)</button>
    <button class="btn btn-sm btn-success" onclick="checkQuizStatus()">Check Quiz Status</button>
    <div id="debug-output" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
  </div>

  <mtk-hierarchy class="mtk-hierarchy" role="main" aria-label="Course Hierarchy">
    <div class="container mtk-hierarchy__container">
      <div class="row mtk-hierarchy__row">
        <div class="col-md-4">
          <nav class="mtk-hierarchy-lhs" aria-label="Course navigation">
            <!-- Content will be injected here -->
          </nav>
        </div>
        <div class="col-md-8">
          <main class="mtk-hierarchy-rhs" role="main">
            <div class="mtk-hierarchy-rhs__empty">
              <span class="material-icons" aria-hidden="true">touch_app</span>
              <p>Select a lesson or resource to view content</p>
            </div>
          </main>
        </div>
      </div>
    </div>
  </mtk-hierarchy>

  <!-- jQuery (if needed by wc.js) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- wc.js Library (PubSub fallback) -->
  <script>
    if (typeof wc === 'undefined') {
      window.wc = {
        log: console.log.bind(console),
        info: console.info.bind(console),
        warn: console.warn.bind(console),
        error: console.error.bind(console),
        group: console.group.bind(console),
        groupEnd: console.groupEnd.bind(console),
        publish: function(message, data) {
          if (typeof PubSub !== 'undefined') {
            return PubSub.publish(message, data);
          }
          console.log('wc.publish:', message, data);
        },
        subscribe: function(message, func) {
          if (typeof PubSub !== 'undefined') {
            return PubSub.subscribe(message, func);
          }
          console.log('wc.subscribe:', message);
          return function() {};
        }
      };
      
      // Simple PubSub fallback
      window.PubSub = (function() {
        var messages = {};
        var lastUid = -1;
        
        return {
          publish: function(message, data) {
            if (!messages[message]) return false;
            var subscribers = messages[message];
            for (var s in subscribers) {
              if (subscribers.hasOwnProperty(s)) {
                setTimeout((function(subscriber) {
                  return function() {
                    subscriber(message, data);
                  };
                })(subscribers[s]), 0);
              }
            }
            return true;
          },
          subscribe: function(message, func) {
            if (!messages[message]) {
              messages[message] = {};
            }
            var token = 'uid_' + String(++lastUid);
            messages[message][token] = func;
            return token;
          }
        };
      })();
    }
  </script>
  
  <!-- Configuration -->
  <script src="mtk-hierarchy.config.js"></script>
  <!-- Hierarchy Logic -->
  <script src="mtk-hierarchy.js"></script>
  
  <!-- Debug Functions -->
  <script>
    function unlockQuiz() {
      wc.log("üîì Manually unlocking quiz for Module 1...");
      
      // Find module-1 in config
      if (window.app && window.app.hierarchy) {
        const course = window.app.hierarchy[0];
        if (course && course.modules) {
          const module1 = course.modules.find(m => m.id === 'module-1');
          if (module1 && module1.quiz) {
            // Enable quiz
            module1.quiz.access = true;
            
            // Force re-render
            if (window.MTKHierarchy) {
              window.MTKHierarchy.renderCourses();
              updateDebug('‚úÖ Quiz unlocked and re-rendered! Expand Module 1 to see it.');
            } else {
              // Update UI manually
              const quizElement = document.querySelector('[data-quiz-id="quiz-module-1"]');
              if (quizElement) {
                quizElement.classList.remove('mtk-quiz--disabled');
                updateDebug('‚úÖ Quiz unlocked! Click on the quiz link.');
              } else {
                updateDebug('‚ùå Quiz element not found. Module may be collapsed.');
              }
            }
          } else {
            updateDebug('‚ùå Quiz not found in module config');
          }
        }
      }
    }
    
    function checkQuizStatus() {
      let debugMsg = '';
      
      if (window.app && window.app.hierarchy) {
        const course = window.app.hierarchy[0];
        if (course && course.modules) {
          const module1 = course.modules.find(m => m.id === 'module-1');
          if (module1 && module1.quiz) {
            const status = module1.quiz.access ? 'üü¢ UNLOCKED' : 'üî¥ LOCKED';
            debugMsg += `<strong>Config Status:</strong><br>`;
            debugMsg += `Quiz: ${status}<br>`;
            debugMsg += `ID: ${module1.quiz.id}<br>`;
            debugMsg += `Access: ${module1.quiz.access}<br><br>`;
          }
        }
      }
      
      // Check DOM
      const quizElement = document.querySelector('[data-quiz-id="quiz-module-1"]');
      debugMsg += `<strong>DOM Status:</strong><br>`;
      if (quizElement) {
        const isDisabled = quizElement.classList.contains('mtk-quiz--disabled');
        debugMsg += `Element: Found ‚úÖ<br>`;
        debugMsg += `Disabled: ${isDisabled ? 'üî¥ YES' : 'üü¢ NO'}<br>`;
        debugMsg += `Classes: ${quizElement.className}<br>`;
      } else {
        debugMsg += `Element: ‚ùå Not in DOM<br>`;
        debugMsg += `Tip: Expand Module 1 first`;
      }
      
      updateDebug(debugMsg);
    }
    
    function updateDebug(message) {
      document.getElementById('debug-output').innerHTML = message;
    }
    
    // Add click listener to whole document to debug
    document.addEventListener('click', function(e) {
      const quiz = e.target.closest('.mtk-quiz');
      if (quiz) {
        wc.log('üñ±Ô∏è Quiz element clicked:', quiz);
        wc.log('Quiz ID:', quiz.dataset.quizId);
        wc.log('Module ID:', quiz.dataset.moduleId);
        wc.log('Disabled:', quiz.classList.contains('mtk-quiz--disabled'));
      }
    });
    
    // Log quiz clicks
    wc.subscribe('mtk-hierarchy:quiz-clicked', function(msg, data) {
      wc.info('üéØ Quiz Clicked Event:', data);
      updateDebug('‚úÖ Quiz clicked! Check RHS for Start Quiz button.');
    });
    
    wc.subscribe('mtk-hierarchy:module-completed', function(msg, data) {
      wc.info('‚úÖ Module Completed Event:', data);
      updateDebug('üéâ Module completed! Header should be green.');
    });
    
    // Auto-check status on load
    setTimeout(checkQuizStatus, 1000);
  </script>

</body>
</html>
